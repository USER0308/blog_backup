技术实现
场景描述:A公司和B公司结成联盟,约定好公司间共享的数据,加入到我们的”依链通”系统中来使用数据共享服务.用户U使用A公司的账户授权登录到B公司,使用B公司的服务.

用户访问授权登录页面时,使用的是传统的B/S架构,即浏览器/服务器架构,用户在浏览器中提交访问请求,服务器作出相应的回答,系统绝大部分数据存储在服务器中,避免了用户需要另外安装客户端的麻烦,同时又不占用用户的磁盘空间.这里的服务器指的是传统的Web服务器,如Apache或者Nginx,用于解析用户发起的请求.
[插图1]
Web服务器接收到用户发起的授权登录请求后,向区块链服务器发起一个”区块链中是否存在该用户的信息”的查询请求,区块链服务器是一个中间件,主要作用是将用户与区块链之间对接起来,为用户提供基于RESTful API的区块链服务.对用户来说,区块链服务器隐藏了区块链层的细节,使得偌大的区块链宛如普通的数据库,为用户提供增删改查的基本操作.
[插图2]
Web服务器向区块链服务器发起查询请求之后,区块链服务器就会在区块链的数据库中查询是否存在该用户的信息,如果用户是首次授权登录,那么区块链数据库中显然没有他的相关信息.这时区块链服务器会向用户账户所在的公司/企业(即A公司)的Web服务器发起一个授权请求,请求参数包含了用户U在A公司的帐号密码等信息,A公司Web服务器检查请求,验证帐号密码等信息,验证通过后可以授权给B公司,根据两家公司约定好共享的数据类型,A公司将用户U在A公司的某些个人信息按照共享数据为模板发送给区块链服务器,区块链服务器接收到这些A,B公司约定共享的数据后,将其保存在区块链中,并以用户U在A公司的帐号作为标识,将其个人信息经过加密后保存在区块链数据库中.
[插图3]
区块链服务器获得了用户U的共享信息后,将其转发给B公司的Web服务器,Web服务器后端再将这些信息写入后Web服务器对应的Web数据库中,用户U信息完成了同步,B公司的Web服务器返回一个授权登录成功的页面,于是用户U就可以使用B公司的服务了.
[插图4]
假设C公司和A,B公司组成联盟,用户U想使用A公司的账户登录C公司,使用其提供的服务,用户U访问授权登录页面,发起授权请求,此时区块链服务器在区块链数据库中查询用户U在A公司的信息,发现区块链数据库中已经存在了,就不必再次向A公司的Web服务器发起授权请求,直接将区块链中用户U的共享信息转发给C公司Web服务器,完成授权.
[插图5]
需要指出的是,区块链服务器虽然在上文中反复出现,但它并非只有一个,有可能是多个服务器提供相同的功能,如果只有一个区块链服务器有违去中心化的思想,而且也容易造成单点失效问题,在Web服务器中维护着所有(或大多数)区块链服务器的域名或ip地址,发起请求时会随机从中挑选一个区块链服务器作为本次会话的建立者.
[插图6]
由于区块链是基于P2P网络,用户U的个人信息很快就会被同步到P2P网络中的各个节点,所以不管是哪个区块链服务器,都能在自己的区块链数据库中查询到加密后的用户U的个人信息.
[插图7]